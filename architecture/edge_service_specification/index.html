
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Mozilla Telemetry ingestion on Google Cloud Platform">
      
      
        <meta name="author" content="Mozilla Data Platform Team">
      
      
      
        <link rel="prev" href="../edge_migration_plan/">
      
      
        <link rel="next" href="../landfill_service_specification/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Edge Service Specification - GCP Ingestion</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#edge-service-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GCP Ingestion" class="md-header__button md-logo" aria-label="GCP Ingestion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GCP Ingestion
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Edge Service Specification
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/gcp-ingestion/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ingestion-edge/" class="md-tabs__link">
          
  
  ingestion-edge

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ingestion-beam/" class="md-tabs__link">
          
  
  ingestion-beam

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ingestion-sink/" class="md-tabs__link">
          
  
  ingestion-sink

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GCP Ingestion" class="md-nav__button md-logo" aria-label="GCP Ingestion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GCP Ingestion
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/gcp-ingestion/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bigquery_sink_specification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Live Sink Service Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decoder_service_specification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder Service Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../differences_from_aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differences from AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../edge_migration_plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plans for migrating edge traffic to GCP Ingestion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Edge Service Specification
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Edge Service Specification
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      General Data Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespaces" class="md-nav__link">
    <span class="md-ellipsis">
      Namespaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwarding-to-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Forwarding to the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-message-schema" class="md-nav__link">
    <span class="md-ellipsis">
      PubSub Message Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-requestresponse" class="md-nav__link">
    <span class="md-ellipsis">
      Server Request/Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Request/Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-request" class="md-nav__link">
    <span class="md-ellipsis">
      GET Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      GET Response codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postput-request" class="md-nav__link">
    <span class="md-ellipsis">
      POST/PUT Request
    </span>
  </a>
  
    <nav class="md-nav" aria-label="POST/PUT Request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legacy-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Legacy Systems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postput-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      POST/PUT Response codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Other Response codes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Other Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    <span class="md-ellipsis">
      Compression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bad-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Bad Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-topics" class="md-nav__link">
    <span class="md-ellipsis">
      PubSub Topics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geoip-lookups" class="md-nav__link">
    <span class="md-ellipsis">
      GeoIP Lookups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-timestamp-format" class="md-nav__link">
    <span class="md-ellipsis">
      Submission Timestamp Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../landfill_service_specification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raw Sink Service Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pain_points/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pain points
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reliability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reliability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Requirements
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ingestion-edge
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            ingestion-edge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-edge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ingestion-beam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ingestion-beam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingestion beam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Ingestion beam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/contextual-services-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contextual Services Reporter Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/decoder-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decoder Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/ingestion_testing_workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingestion Testing Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/rally-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rally Decoder Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/republisher-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Republisher Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-beam/sink-job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sink Job
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ingestion-sink
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            ingestion-sink
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-sink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      General Data Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespaces" class="md-nav__link">
    <span class="md-ellipsis">
      Namespaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwarding-to-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Forwarding to the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-message-schema" class="md-nav__link">
    <span class="md-ellipsis">
      PubSub Message Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-requestresponse" class="md-nav__link">
    <span class="md-ellipsis">
      Server Request/Response
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Request/Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-request" class="md-nav__link">
    <span class="md-ellipsis">
      GET Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      GET Response codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postput-request" class="md-nav__link">
    <span class="md-ellipsis">
      POST/PUT Request
    </span>
  </a>
  
    <nav class="md-nav" aria-label="POST/PUT Request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legacy-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Legacy Systems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postput-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      POST/PUT Response codes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Other Response codes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Other Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    <span class="md-ellipsis">
      Compression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bad-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Bad Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub-topics" class="md-nav__link">
    <span class="md-ellipsis">
      PubSub Topics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geoip-lookups" class="md-nav__link">
    <span class="md-ellipsis">
      GeoIP Lookups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-timestamp-format" class="md-nav__link">
    <span class="md-ellipsis">
      Submission Timestamp Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="edge-service-specification">Edge Service Specification</h1>
<p>This document specifies the behavior of the server that accepts submissions
from HTTP clients e.g. Firefox telemetry.</p>
<h2 id="general-data-flow">General Data Flow</h2>
<p>HTTP submissions come in from the wild, hit a load balancer, then optionally an
nginx proxy, then the HTTP edge server described in this document. Data is
accepted via a POST/PUT request from clients, which the server will wrap in a
<a href="https://cloud.google.com/pubsub/docs/reference/rest/v1/PubsubMessage">PubSub message</a>
and forward to Google Cloud PubSub, where any further processing, analysis, and storage will
be handled.</p>
<h3 id="namespaces">Namespaces</h3>
<p>Namespaces are used to control the processing of data from different types of
clients, from the metadata that is collected to the destinations where the data
is written, processed and accessible. Data sent to a namespace that is not
specifically configured is assumed to be in the
<a href="https://docs.telemetry.mozilla.org/cookbooks/new_ping.html">non-Telemetry JSON format described here</a>.
To request a new namespace configuration file a bug against the
<a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data%20Platform%20and%20Tools&amp;component=Pipeline%20Ingestion">Data Platform Team</a>
with a short description of what the namespace will be used for and the desired
configuration options.</p>
<h3 id="forwarding-to-the-pipeline">Forwarding to the pipeline</h3>
<p>The message is written to PubSub. If the message cannot be written to PubSub it
is written to a disk queue that will periodically retry writing to PubSub.</p>
<h3 id="pubsub-message-schema">PubSub Message Schema</h3>
<pre><code>required string data                   // base64 encoded body
required group attributes {
  required string submission_timestamp // server time, ISO 8601 with microseconds and timezone &quot;Z&quot;, example: &quot;2018-03-12T21:02:18.123456Z&quot;
  required string uri                  // example: &quot;/submit/telemetry/6c49ec73-4350-45a0-9c8a-6c8f5aded0cf/main/Firefox/58.0.2/release/20180206200532&quot;
  required string protocol             // example: &quot;HTTP/1.1&quot;
  required string method               // example: &quot;POST&quot;
  optional string args                 // query parameters, example: &quot;v=4&quot;
  // Headers
  optional string remote_addr          // usually a load balancer, example: &quot;172.31.32.5&quot;
  optional string content_length       // example: &quot;4722&quot;
  optional string date                 // example: &quot;Mon, 12 Mar 2018 21:02:18 GMT&quot;
  optional string dnt                  // example: &quot;1&quot;
  optional string host                 // example: &quot;incoming.telemetry.mozilla.org&quot;
  optional string user_agent           // example: &quot;pingsender/1.0&quot;
  optional string x_forwarded_for      // example: &quot;10.98.132.74, 103.3.237.12&quot;
  optional string x_pingsender_version // example: &quot;1.0&quot;
  optional string x_debug_id           // example: &quot;my_debug_session_1&quot;
  optional string x_pipeline_proxy     // time that the AWS-&gt;GCP tee received the message, ignored, example: &quot;2018-03-12T21:02:18.123456Z&quot;
  optional string x_telemetry_agent    // example: &quot;Glean/0.40.0 (Kotlin on Android)&quot;
  optional string x_source_tags        // example: &quot;automation, other&quot;
  optional string x_foxsec_ip_reputation // example: &quot;95&quot;
  optional string x_lb_tags            // example: &quot;TLSv1.3, 009C&quot;
}
</code></pre>
<h2 id="server-requestresponse">Server Request/Response</h2>
<h3 id="get-request">GET Request</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/__heartbeat__</code></td>
<td>check if service is healthy, and can reach PubSub or has space to store requests on disk</td>
</tr>
<tr>
<td><code>/__lbheartbeat__</code></td>
<td>check if service is running</td>
</tr>
<tr>
<td><code>/__version__</code></td>
<td>return Dockerflow <a href="https://github.com/mozilla-services/Dockerflow/blob/main/docs/version_object.md">version object</a></td>
</tr>
</tbody>
</table>
<h3 id="get-response-codes">GET Response codes</h3>
<ul>
<li><em>200</em> - ok, check succeeded</li>
<li><em>204</em> - ok, check succeeded, no response body</li>
<li><em>404</em> - not found, check doesn't exist</li>
<li><em>500</em> - all is not well</li>
<li><em>507</em> - insufficient storage, should occur at some configurable limit before disk is full</li>
</ul>
<h3 id="postput-request">POST/PUT Request</h3>
<p>Treat POST and PUT the same. Accept POST or PUT to URLs of the form</p>
<p><code>^/submit/namespace/[/dimensions]$</code></p>
<p>Example Telemetry format:</p>
<p><code>/submit/telemetry/docId/docType/appName/appVersion/appUpdateChannel/appBuildID</code></p>
<p>Specific Telemetry example:</p>
<p><code>/submit/telemetry/ce39b608-f595-4c69-b6a6-f7a436604648/main/Firefox/61.0a1/nightly/20180328030202</code></p>
<p>Example non-Telemetry format:</p>
<p><code>/submit/namespace/docType/docVersion/docId</code></p>
<p>Specific non-Telemetry example:</p>
<p><code>/submit/eng-workflow/hgpush/1/2c3a0767-d84a-4d02-8a92-fa54a3376049</code></p>
<p>Note that <code>docId</code> above is a unique document ID, which is used for de-duping
submissions. This is <em>not</em> intended to be the <code>clientId</code> field from Telemetry.
<code>docId</code> is required and must be a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>.</p>
<h4 id="legacy-systems">Legacy Systems</h4>
<p>Accept <a href="https://wiki.mozilla.org/SecurityEngineering/TLS_Error_Reports">TLS Error Reports</a>
as POST or PUT to <code>/submit/sslreports</code> with no <code>docType</code>, <code>docVersion</code>, or
<code>docId</code>.</p>
<p>Accept <a href="https://firefox-source-docs.mozilla.org/browser/installer/windows/installer/StubPing.html">Stub Installer pings</a>
as GET to <code>/stub/[docVersion]/[dimensions]</code>, with no <code>docType</code> or <code>docId</code>, and
over both HTTP and HTTPS. Use <a href="#postput-response-codes">POST/PUT Response codes</a>,
even though this endpoint is for GET requests.</p>
<h3 id="postput-response-codes">POST/PUT Response codes</h3>
<ul>
<li><em>200</em> - ok, request accepted into the pipeline</li>
<li><em>400</em> - bad request, for example an unencoded space in the URL</li>
<li><em>404</em> - not found, for example using a telemetry format URL in a non-telemetry namespace or vice-versa</li>
<li><em>411</em> - missing content-length header</li>
<li><em>413</em> - request body too large (note that if we have badly-behaved clients that retry on <code>4XX</code>, we should send back 202 on body/path too long).</li>
<li><em>414</em> - request path too long (see above)</li>
<li><em>500</em> - internal error</li>
<li><em>507</em> - insufficient storage, request failed because disk is full</li>
</ul>
<h3 id="other-response-codes">Other Response codes</h3>
<ul>
<li><em>405</em> - wrong request type (anything other than GET|POST|PUT)</li>
</ul>
<h2 id="other-considerations">Other Considerations</h2>
<h3 id="compression">Compression</h3>
<p>It is not desirable to do decompression on the edge node. We want to pass along
messages from the HTTP Edge node without "cracking the egg" of the payload.</p>
<p>We may also receive badly formed payloads, and we will want to track the
incidence of such things.</p>
<h3 id="bad-messages">Bad Messages</h3>
<p>Since the actual message is not examined by the edge server the only failures
that occur are defined by the response status codes above. Messages are only
forwarded to the pipeline when a response code of 200 is returned to the
client.</p>
<h3 id="pubsub-topics">PubSub Topics</h3>
<p>All messages that sent a response code of 200 are forwarded to a single PubSub
topic for decoding and landfill.</p>
<h3 id="geoip-lookups">GeoIP Lookups</h3>
<p>No GeoIP lookup is performed by the edge server. If a client IP is available
then the PubSub consumer performs the lookup and then discards the IP before
the message is forwarded to a decoded PubSub topic.</p>
<h3 id="data-retention">Data Retention</h3>
<p>The edge server only stores data when PubSub cannot be reached, and removes
data after it is successfully written to PubSub. Down scaling will be disabled
for the Kubernetes pod and cluster when data is being stored, so that data is
not lost.</p>
<h3 id="submission-timestamp-format">Submission Timestamp Format</h3>
<p><code>submission_timestamp</code> is formatted as ISO 8601 with microseconds and timezone,
because it is compatible with BigQuery's
<a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#timestamp-type">Timestamp Type</a>,
so that the field doesn't need transformation.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.expand"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>